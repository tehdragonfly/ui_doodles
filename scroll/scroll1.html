<!DOCTYPE html>
<html>
<head>
<title>scroll test</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<style>

body {
    min-height: 100vh;
    box-sizing: border-box;
    margin: 0;
    padding: 50px;
    background-color: #eee;
    font-family: sans-serif;
    line-height: 1.5rem;
}

main {
    display: flex;
    justify-content: center;
}

.column { flex: 0 1 650px; }
.column:not(:first-child) { margin-left: 25px; }

.column_content { max-width: 100%; padding: 50px 0; }

.tile {
    max-width: 650px;
    box-sizing: border-box;
    overflow: hidden;
    padding: 8px 32px;
    background-color: #fff;
    box-shadow: 0 1px 2px #bbb;
}

.tile:not(:first-child) {
    margin-top: 24px;
}

</style>
</head>
<body>

<main>
  <div class="column">
    <div class="column_content">
      <div class="tile">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Proin lacinia sodales mauris, semper sollicitudin ipsum tristique et. Phasellus id placerat lacus. Sed eu nibh ac nisl consequat tempus. Nunc sem leo, tempus ut ligula sed, efficitur rhoncus sem. Etiam et sollicitudin mi. Nam non neque ut mi pulvinar fermentum id eu risus. Etiam non auctor augue, et bibendum sem. Morbi convallis rutrum lectus eget molestie.</p>
        <p>Praesent eget ligula consequat, mattis purus sit amet, lacinia lorem. Aenean tincidunt risus libero, vel finibus mi gravida nec. Aliquam pulvinar arcu non ex venenatis mattis. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Integer id urna non metus facilisis consectetur. Aenean elementum tincidunt laoreet. Fusce lobortis mauris ac neque accumsan egestas a lacinia lorem.</p>
        <p>Proin vestibulum mattis lorem vitae dictum. Nulla dignissim id odio ut laoreet. Mauris at nulla volutpat, eleifend ex nec, rutrum massa. Nulla tempor nibh quis aliquet ultricies. Integer vehicula, diam nec venenatis pretium, ex purus sagittis elit, vel tincidunt sem orci posuere justo. Integer ut leo quis nibh feugiat varius ac in neque. Cras venenatis vulputate eros, eu malesuada elit bibendum et.</p>
        <p>Praesent scelerisque massa a justo tincidunt, a pellentesque ipsum commodo. Etiam vitae tincidunt nunc. Integer accumsan tortor ut mauris pretium, a consectetur augue maximus. Quisque quis volutpat libero. Fusce venenatis fringilla nisl, in ultricies risus euismod ac. Duis in eros dapibus, placerat risus non, sollicitudin risus. Nam malesuada bibendum mattis. Duis luctus nulla vel velit imperdiet auctor. Pellentesque consectetur risus nec sem accumsan euismod. Morbi at ullamcorper nunc, a feugiat velit. Sed ornare ac diam sit amet lobortis. Curabitur varius mattis sem, ac venenatis ligula imperdiet quis. Nunc sit amet diam convallis, aliquet libero quis, pharetra leo. Praesent eget laoreet leo, a fringilla arcu. Vestibulum lorem lacus, commodo sit amet risus vitae, faucibus suscipit lorem.</p>
        <p>Fusce eros velit, malesuada nec pharetra sit amet, pretium sit amet arcu. Nulla congue lectus orci, vel tempor felis rhoncus vel. Sed euismod, erat quis suscipit tempor, tortor nulla semper nulla, at varius nisl lectus eget tortor. Morbi et augue sit amet sem faucibus posuere eu ac odio. Quisque interdum enim ac blandit sollicitudin. Fusce ut hendrerit lectus. Phasellus condimentum dictum feugiat. Donec sed finibus purus. Aliquam sollicitudin dui nec sapien pretium condimentum. Donec in molestie dolor, eget efficitur ex. Etiam molestie egestas nisl, at blandit ligula maximus sed. Sed pretium lorem sed nisl tincidunt dapibus.</p>
      </div>
    </div>
  </div>
  <div class="column">
    <div class="column_content">
      <div class="tile">
        <p>Lorem ipsum dolor sit amet, consectetur adipiscing elit. Morbi orci augue, commodo eget purus in, auctor imperdiet dolor. Integer vehicula magna in nisl fringilla lobortis. Donec ultrices euismod lorem, quis egestas augue laoreet ac. Vivamus consectetur ex nec nisl aliquet sodales. Sed dictum lectus quis augue maximus, ac porta nunc lacinia. Nunc in tempus elit. Nulla sollicitudin risus ac leo efficitur lobortis. Vestibulum vehicula lectus nec maximus tincidunt. Cras dignissim purus ac lacus tempus, at luctus libero aliquet.</p>
      </div>
      <div class="tile">
        <p>Donec gravida ut risus vitae rhoncus. Sed hendrerit eros vel odio finibus, ac vulputate orci elementum. Fusce eu neque nisi. Donec tempor tellus a tortor aliquam, nec viverra tortor malesuada. Vestibulum gravida porta lobortis. Maecenas non auctor arcu. Proin non porttitor dolor.</p>
      </div>
      <div class="tile">
        <p>Duis fringilla ex quis tempor rhoncus. Donec enim ante, rutrum ac viverra vitae, efficitur id nisi. Nulla euismod accumsan sem ut fermentum. Mauris malesuada justo sit amet leo egestas tempor. Quisque ultricies, mauris sit amet elementum rhoncus, enim odio feugiat dolor, a maximus arcu augue ut felis. Sed nisl eros, dignissim ut rutrum euismod, lacinia sit amet eros. Curabitur consequat urna ut orci lacinia, nec facilisis purus tristique. Nulla sit amet mollis enim, ut lobortis tortor. Pellentesque sollicitudin leo at accumsan volutpat. Donec condimentum justo vitae posuere elementum. Cras at urna viverra, lacinia risus sit amet, hendrerit ante. Etiam vitae elit maximus, commodo quam venenatis, vulputate orci. Morbi venenatis, arcu vitae ornare fermentum, libero augue porttitor risus, eget dignissim orci lacus vitae risus. Suspendisse pharetra id ante non dignissim.</p>
      </div>
      <div class="tile">
        <p>Donec commodo ullamcorper lacus. Maecenas pulvinar elit tellus, eget consequat metus tempor quis. Aliquam placerat velit ex, sed fringilla tortor posuere ut. Sed condimentum mauris id nunc finibus eleifend. Praesent et semper neque. Nullam pulvinar aliquam urna finibus vestibulum. Etiam tincidunt porta ex sit amet porta. Vivamus et laoreet mi.</p>
      </div>
      <div class="tile">
        <p>Sed at porta purus. Aenean pretium id purus in laoreet. Donec vel dolor id ex vehicula iaculis posuere sit amet elit. Duis purus mauris, condimentum quis volutpat eget, sagittis nec nisi. Fusce nec urna sed tortor cursus tristique. Phasellus rutrum, urna nec efficitur blandit, ante arcu commodo lacus, ac ultrices mi ligula in neque. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Quisque imperdiet velit posuere enim tristique varius.</p>
      </div>
      <div class="tile">
        <p>Nullam lobortis viverra lacinia. In sit amet neque sed eros finibus dictum. Integer egestas pretium metus, sodales malesuada massa porttitor id. Nam vel eros vel nibh porttitor mattis. Cras odio nisi, feugiat ut finibus quis, consequat dignissim diam. In porta quis ex eu lacinia. Vivamus et metus in ligula posuere mollis quis nec metus. Curabitur at quam metus. Interdum et malesuada fames ac ante ipsum primis in faucibus. Proin convallis urna sed ipsum pretium, nec scelerisque tellus maximus. Ut imperdiet consequat magna, vitae ultrices augue dapibus ac. Nunc nec mattis arcu. Nullam facilisis erat quis vulputate maximus.</p>
      </div>
      <div class="tile">
        <p>In eget risus arcu. Fusce at accumsan augue. Nam pulvinar rutrum diam a consectetur. Etiam ac varius felis, eget fermentum tellus. Cras porttitor purus in odio gravida, id consequat lorem tempus. Sed ligula velit, laoreet vel libero eu, tincidunt iaculis mauris. Maecenas hendrerit, nulla ac euismod gravida, leo ligula fringilla purus, et dapibus sapien magna sed diam.</p>
      </div>
      <div class="tile">
        <p>Nulla vel pharetra purus. Cras felis eros, posuere eu congue interdum, ullamcorper et leo. Curabitur malesuada elit id leo accumsan dignissim. Donec erat urna, condimentum a euismod et, consectetur vitae enim. Class aptent taciti sociosqu ad litora torquent per conubia nostra, per inceptos himenaeos. Morbi convallis at orci ut tincidunt. Morbi hendrerit massa erat, in aliquet erat ultricies eget. Nunc vehicula nisl vitae mattis suscipit. Nam viverra viverra odio, quis pulvinar leo pharetra sit amet. Sed lobortis ex in pretium hendrerit. Proin a commodo ante, eget malesuada diam. In dignissim augue elit, et egestas magna sollicitudin in. Vivamus rhoncus accumsan posuere. </p>
      </div>
    </div>
  </div>
</main>

<script>

const columns = document.querySelectorAll(".column_content");

var last_scroll_position = 0;
var last_max_column_height = 0;
var resized = true;

function update_scroll_position() {
    if (resized) {
        console.log("resize");
        columns.forEach((column) => {
            column.style.width = column.parentNode.getBoundingClientRect().width + "px";
        });
        resized = false;
    }

    const max_column_height = Math.max.apply(Math, Array.prototype.map.call(columns, c => c.getBoundingClientRect().height));

    if (max_column_height != last_max_column_height) {
        columns.forEach((column) => {
            column.parentNode.style.height = max_column_height + "px";
            column.style.position = "fixed";
        });
    }

    if (window.scrollY != last_scroll_position || max_column_height != last_max_column_height) {
        last_scroll_position = window.scrollY;
        last_max_column_height = max_column_height;

        const window_max_scroll_y = document.documentElement.scrollHeight - document.documentElement.clientHeight;
        const window_scroll_percentage = window.scrollY / window_max_scroll_y;

        columns.forEach((column) => {
            const client_rect = column.getBoundingClientRect();
            const column_max_scroll_y = client_rect.height - document.documentElement.clientHeight;
            if (window_max_scroll_y <= 0 || column_max_scroll_y <= 0) {
                column.style.top = 0;
            } else {
                const column_scroll_distance = Math.floor(window_scroll_percentage * column_max_scroll_y);
                column.style.top = -column_scroll_distance + "px";
            }
        });

    }

    window.requestAnimationFrame(update_scroll_position);
}
window.requestAnimationFrame(update_scroll_position);

window.addEventListener("resize", function() {
    resized = true;
});

</script>

</body>
</html>
